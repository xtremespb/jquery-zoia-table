/*! zoiaTable v1.0.0 | (c) Michael A. Matveev | github.com/xtremespb/zoiaTable 
*/ 
;'use strict';(function(a){'use strict';function b(g,k){this.element=g,this.settings=a.extend({},f,k),this._defaults=f,this._name=c,this.page=1,this.loading=!1,this.search='',this.currentData={},this.init()}var c='zoiaTable',f={limit:10,maxPages:7,html:{spinnerHTML:'<div style="width:40px;height:40px;background-color:#333;-webkit-animation:sk-rotateplane 1.2s infinite ease-in-out;animation: sk-rotateplane 1.2s infinite ease-in-out;margin: auto;position: absolute;top:0;left:0;bottom:0;right:0"></div>',spinnerWrapCSS:'background:#fff;position:absolute;opacity:0.6',headCSS:'@-webkit-keyframes sk-rotateplane{0%{-webkit-transform:perspective(120px)}50%{-webkit-transform:perspective(120px) rotateY(180deg)}100%{-webkit-transform:perspective(120px) rotateY(180deg) rotateX(180deg)}}@keyframes sk-rotateplane{0%{transform:perspective(120px) rotateX(0deg) rotateY(0deg);-webkit-transform:perspective(120px) rotateX(0deg) rotateY(0deg)}50%{transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg);-webkit-transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg)}100%{transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg);-webkit-transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg)}}',listWrapStartHTML:'<ul class="za-pagination" za-margin>',listWrapEndHTML:'</ul>',itemPagePrevHTML:'<li><a href="#"><a class="zoia-page {elementId}PaginationLink" data-page="{page}"><span za-pagination-previous></span></a></li>',itemPageNextHTML:'<li><a href="#"><a class="zoia-page {elementId}PaginationLink" data-page="{page}"><span za-pagination-next></span></a></li>',itemPageHTML:'<li><a class="zoia-page {elementId}PaginationLink" data-page="{page}">{page}</a></li>',itemPageDotsHTML:'<li class="za-disabled"><span>...</span></li>',arrowDown:'&nbsp;&#x25BC;',arrowUp:'&nbsp;&#x25B2;',errorHTML:'<tr><td colspan="100%">{error}</td></tr>'},lang:{error:'Could not load data from server. Please try to refresh page in a few moments.',noitems:'No items to display'},sort:{},loadOnStart:!0,onLoad:function onLoad(){}};a.extend(b.prototype,{init:function init(){var g=this;a('head').append('<style type="text/css">'+this.settings.html.headCSS+'</style>'),a(this.element).before('<div style="'+this.settings.html.spinnerWrapCSS+'" id="'+this.element.id+'LoadingDiv">'+this.settings.html.spinnerHTML+'</div>'),this._loading(!1),this.header=[];for(var l,k=0;k<a('#'+this.element.id+' > thead > tr').children('th').length;k++)if(l=a('#'+this.element.id+' > thead > tr').children('th')[k],l.id){this.header.push(l.id);var m=l.id.replace(new RegExp('^'+this.element.id+'_'),'');this.settings.fields[m]&&this.settings.fields[m].sortable&&(a(l).css('cursor','pointer'),a(l).click(function(n){g._sortColumn(n)}))}a('.'+this.element.id+'SearchInput').keypress(g._debounce(function(n){g._search(n)},250)),a('.'+this.element.id+'SearchInputClear').click(function(n){g._searchReset(n)}),this.settings.loadOnStart&&this.load()},_search:function _search(g){this.loading||(this.search=a(g.target).val().trim(),this.page=1,this.load())},_searchReset:function _searchReset(){this.loading||(a('.'+this.element.id+'SearchInput').val('').focus(),this.search='',this.page=1,this.load())},_sortIndicator:function _sortIndicator(g,k){a('#'+this.element.id+'SortingIndicator').remove();for(var n,l='desc'===k?this.settings.html.arrowDown:this.settings.html.arrowUp,m=0;m<a('#'+this.element.id+' > thead > tr').children('th').length;m++)n=a('#'+this.element.id+' > thead > tr').children('th')[m],n.id===this.element.id+'_'+g&&a(n).html(a(n).html()+'<span class="zoiaTableSortingIndicator" id="'+this.element.id+'SortingIndicator">'+l+'</span>')},_sortColumn:function _sortColumn(g){if(g.preventDefault(),g.target.id&&g.target.id!==this.element.id+'SortingIndicator'){var k=g.target.id.replace(new RegExp('^'+this.element.id+'_'),'');this.settings.sort.field===k?this.settings.sort.direction='asc'===this.settings.sort.direction?'desc':'asc':(this.settings.sort.field=k,this.settings.sort.direction='asc'),this.load()}},_template:function _template(g,k){for(var l in k)g=g.replace(new RegExp('{'+l+'}','g'),k[l]);return g},_bindSelectButtons:function _bindSelectButtons(){var g=this;a('.'+this.element.id+'BtnSelectAll').click(function(){g._selectAll()}),a('.'+this.element.id+'BtnSelectNone').click(function(){g._selectNone()})},_selectAll:function _selectAll(){this.loading||a('.'+this.element.id+'Checkbox').prop('checked',!0)},_selectNone:function _selectNone(){this.loading||a('.'+this.element.id+'Checkbox').prop('checked',!1)},_pagination:function _pagination(){var g=this,k=this.settings.maxPages,l=Math.ceil(this.total/this.settings.limit);if(2>l)return void a('.'+this.element.id+'Pagination').html('');var m=this.settings.html.listWrapStartHTML;if(l>k){1<this.page&&(m+=this._template(this.settings.html.itemPagePrevHTML,{elementId:this.element.id,page:this.page-1})),3<this.page&&(m+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:1}));var n=this.page-2;1>n&&(n=1),1<n-1&&(m+=this.settings.html.itemPageDotsHTML);var o=this.page+2;o>l&&(o=l);for(var q=n;q<=o;q++)m+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:q});o<l-1&&(m+=this.settings.html.itemPageDotsHTML),this.page<=l-3&&(m+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:l})),this.page<l&&(m+=this._template(this.settings.html.itemPageNextHTML,{elementId:this.element.id,page:this.page+1}))}else for(var r=1;r<=l;r++)m+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:r});m+=this.settings.html.listWrapEndHTML,a('.'+this.element.id+'Pagination').html(m),a('.'+this.element.id+'PaginationLink').click(function(){var t=parseInt(a(this).data('page'),10);g.loading||g.page===t||(g.page=t,g.load())})},_loading:function _loading(g){var k='#'+this.element.id+'LoadingDiv';a(k).css({top:a(this.element).top,left:a(this.element).left,width:a(this.element).outerWidth(!0),height:a(this.element).outerHeight(!0)}),g?this.loadingInt=setTimeout(function(){a(k).show()},300):(clearTimeout(this.loadingInt),a(k).hide())},_debounce:function _debounce(g,k){var l=null;return function(){var m=this,n=arguments;clearTimeout(l),l=setTimeout(function(){g.apply(m,n)},k)}},getCurrentData:function getCurrentData(){return this.currentData},load:function load(){if(this.settings.url&&!this.loading){var g=this,k='';this._loading(!0),this.loading=!0;var l=this._template(this.settings.url,{skip:this.page*this.settings.limit-this.settings.limit});a.ajax({type:'GET',url:l,data:{limit:this.settings.limit,skip:this.page*this.settings.limit-this.settings.limit,sortField:this.settings.sort.field,sortDirection:this.settings.sort.direction,search:this.search},cache:!1}).done(function(m){if(g.loading=!1,m){for(var n in g.pages=parseInt(m.total/g.settings.limit,10),0<m.total%g.settings.limit&&g.pages++,g.total=m.total,g._pagination(),g.currentData={},m.items){var o=m.items[n];for(var q in g.currentData[o._id]=o,k+='<tr>',g.header)if(g.header[q]===g.element.id+'ID')k+='<td><input type="checkbox" id="'+o._id+'" class="za-checkbox '+g.element.id+'Checkbox"></td>';else{var r=!1,t=g.header[q].replace(new RegExp('^'+g.element.id+'_'),'');for(var u in o)u===t&&g.settings.fields[u]&&(k+='<td>'+g.settings.fields[u].process(u,o,o[u])+'</td>',r=!0);r||(g.settings.fields[t]&&g.settings.fields[t].process?k+='<td>'+g.settings.fields[t].process(t,o)+'</td>':k+='<td></td>')}k+='</tr>'}a(g.element).find('tbody').html(k.length?k:g._template(g.settings.html.errorHTML,{error:g.settings.lang.noitems})),g._loading(!1),a('*[data-page="'+g.page+'"]').parent().addClass('za-active'),g._bindSelectButtons(),g.settings.sort.field&&g._sortIndicator(g.settings.sort.field,g.settings.sort.direction),g.settings.onLoad()}else g.loading=!1,g._loading(!1),a(g.element).find('tbody').html(g._template(g.settings.html.errorHTML,{error:g.settings.lang.error}))}).fail(function(){g.loading=!1,g._loading(!1),a(g.element).find('tbody').html(g._template(g.settings.html.errorHTML,{error:g.settings.lang.error}))})}}}),a.fn[c]=function(g){var k;return this.each(function(){k=a.data(this,'plugin_'+c),k||(k=new b(this,g),a.data(this,'plugin_'+c,k))}),k}})(jQuery,window,document);